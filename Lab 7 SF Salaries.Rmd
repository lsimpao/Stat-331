---
title: "Lab 7 - SF Salaries"
author: "Luisa Simpao"
date: "March 5, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 8, fig.height = 4)
```

```{r load packages, message = FALSE}
library(tidyverse)
library(readr)
library(modelr)
library(broom)
```

### The data
1. 
```{r 1_importData, collapse = TRUE, message = FALSE}
salaries <- read_csv("Salaries.csv", na = c("Not Provided", "Not provided", ""))
head(salaries)
```
2. The histogram below is skewed right - there is a short left tail and a longer wide tail.
```{r 2_totalPay}
salary <- salaries %>% 
  pull(TotalPay)

ggplot(, aes(x = salary)) + 
  geom_histogram(aes(y = ..density..), , bins = 20, fill = "pink")
```

3. For distributions that are skewed right, the mean is typically greater than the median. If we want to understand the typical salary of ALL San Francisco city employees, the median might be a better statistic to use over the mean as this would allow for us to avoid the influence of very large salaries. Still, we can probably proceed with the mean.

4. The distribution, though skewed right, appears somewhat bell curved. However, because of the large amount of data (148654 observations!), the Central Limit Theorem may apply so the assumption of normality for a t-test is reasonable.

5. (74511.52,75025.13)
```{r 5_ttest}
tidy(t.test(salary)) %>% select(conf.low, conf.high)
```

### Bootstrapping
6. A confidence interval generated (3/7 2:47 PM): (74494.79, 75022.55) // Similar confidence intervals are generated. The lower limit is lower, but the difference does not seem to be significant.
```{r 6_boots95}
salary_bt <- replicate(1000, sample(salary, replace = TRUE), simplify = FALSE)

salary_mn <- data.frame(
  avgpay = map_dbl(salary_bt, mean))

quantile(salary_mn$avgpay, c(0.025, 0.975))
```

7. See the MIDHINGE and TRIM functions below:
```{r 7_newstats}
midhinge <- function(data){
  q1 = quantile(data, probs = 0.25)
  q3 = quantile(data, probs = 0.75)
  mh = (q1 + q3)/2
  return(mh)
}

trim <- function(data, pct){
  vector <- sort(data)
  half <- pct/2
  x <- round(half*length(vector))
  avg <- mean(vector[(x+1) : (length(vector) - x)])
  return(avg)
}
```

8. The midhinge, trimmed means, and median statistics are pulled for the replicated samples (salary_bt). Histograms for the density for these statistcs are shown below.
```{r 8_}
salary_nw <- data.frame(
  midhinge = map_dbl(salary_bt, midhinge),
  trim_05 = map2_dbl(salary_bt, 0.05, trim),
  trim_10 = map2_dbl(salary_bt, 0.10, trim),
  trim_25 = map2_dbl(salary_bt, 0.25, trim),
  median = map_dbl(salary_bt, median)
  )

ggplot(salary_nw, aes(x = midhinge, y = ..density..)) + geom_histogram(bins = 15)
ggplot(salary_nw, aes(x = trim_05, y = ..density..)) + geom_histogram(bins = 15)
ggplot(salary_nw, aes(x = trim_10, y = ..density..)) + geom_histogram(bins = 15)
ggplot(salary_nw, aes(x = trim_25, y = ..density..)) + geom_histogram(bins = 15)
ggplot(salary_nw, aes(x = median, y = ..density..)) + geom_histogram(bins = 15)

```

9. The generated confidence intervals using bootstrap does not seem to be too different from those generated by the t-test, in regards to spread. However, the generated confidence intervals for the non-mean statistics, all have maximum values below the lower limit from the t-test confidence interval. This follows the logic that the mean tends to be higher than the median for distributions that are skewed right. I would use the median or higher % trimmed mean, because the generated confidence intervals seem to be the less skewed towards high or low. 
```{r 9_conf_int}
quantile(salary_nw$midhinge, c(0.025, 0.975))
quantile(salary_nw$trim_05, c(0.025, 0.975))
quantile(salary_nw$trim_10, c(0.025, 0.975))
quantile(salary_nw$trim_25, c(0.025, 0.975))
quantile(salary_nw$median, c(0.025, 0.975))
```